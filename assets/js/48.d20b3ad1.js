(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{373:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[t._v("#")]),t._v(" Pod")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#简介"}},[t._v("简介")])]),a("li",[a("a",{attrs:{href:"#pod-生命周期"}},[t._v("Pod 生命周期")]),a("ul",[a("li",[a("a",{attrs:{href:"#status"}},[t._v("Status")])]),a("li",[a("a",{attrs:{href:"#conditions"}},[t._v("Conditions")])]),a("li",[a("a",{attrs:{href:"#restart-policy"}},[t._v("Restart Policy")])])])]),a("li",[a("a",{attrs:{href:"#容器管理"}},[t._v("容器管理")]),a("ul",[a("li",[a("a",{attrs:{href:"#imagepullpolicy"}},[t._v("imagePullPolicy")])]),a("li",[a("a",{attrs:{href:"#端口"}},[t._v("端口")])]),a("li",[a("a",{attrs:{href:"#环境变量"}},[t._v("环境变量")])]),a("li",[a("a",{attrs:{href:"#资源限制"}},[t._v("资源限制")])]),a("li",[a("a",{attrs:{href:"#volume-挂载"}},[t._v("Volume 挂载")])]),a("li",[a("a",{attrs:{href:"#probe"}},[t._v("Probe")])]),a("li",[a("a",{attrs:{href:"#hooks"}},[t._v("hooks")])])])]),a("li",[a("a",{attrs:{href:"#init-container"}},[t._v("Init Container")])]),a("li",[a("a",{attrs:{href:"#qos"}},[t._v("QoS")])]),a("li",[a("a",{attrs:{href:"#调度"}},[t._v("调度")])]),a("li",[a("a",{attrs:{href:"#网络配置"}},[t._v("网络配置")]),a("ul",[a("li",[a("a",{attrs:{href:"#hostnetwork"}},[t._v("hostNetwork")])]),a("li",[a("a",{attrs:{href:"#dnspolicy"}},[t._v("dnsPolicy")])]),a("li",[a("a",{attrs:{href:"#dnsconfig"}},[t._v("dnsConfig")])]),a("li",[a("a",{attrs:{href:"#hostaliases"}},[t._v("hostAliases")])])])]),a("li",[a("a",{attrs:{href:"#参考"}},[t._v("参考")])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("ul",[a("li",[t._v("Pod 是 k8s 中最小的执行单元，是对容器的一层包装，每个 Pod 内可以有一个或多个容器")]),t._v(" "),a("li",[t._v("Pod 内的容器共享网络和存储，互相之间可以通过 "),a("code",[t._v("localhost")]),t._v(" 来进行通信")]),t._v(" "),a("li",[t._v("Pod是非持久的、一次性的 (ephemeral, disposable)")]),t._v(" "),a("li",[t._v("Pod 不会自愈，当一个 Pod 失败后，会被删除")]),t._v(" "),a("li",[t._v("Controller（例如 Deployment，StatefulSet，DaemonSet）用于管理 Pod，对 Pod 进行调度，副本管理，滚动升级等")]),t._v(" "),a("li",[t._v("很少直接使用 Pod，一般都是通过 Controller 来使用")]),t._v(" "),a("li",[t._v("Pod template 也通常不直接使用，而是放在 Controller template 里")])]),t._v(" "),a("h2",{attrs:{id:"pod-生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod-生命周期"}},[t._v("#")]),t._v(" Pod 生命周期")]),t._v(" "),a("h3",{attrs:{id:"status"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#status"}},[t._v("#")]),t._v(" Status")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Pending")]),t._v("：尚未调度，镜像在下载中，或者找不到合适的调度节点")]),t._v(" "),a("li",[a("code",[t._v("Running")]),t._v("：被调度到一个节点上，其中至少一个容器还在运行中，启动中或者重启中")]),t._v(" "),a("li",[a("code",[t._v("Succeeded")]),t._v("：所有容器运行成功然后终止，且不会重启")]),t._v(" "),a("li",[a("code",[t._v("Failed")]),t._v("：所有容器已经终止运行，且至少有一个容器失败而终止")]),t._v(" "),a("li",[a("code",[t._v("Unknow")]),t._v("：状态未知")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl describe po nginx-66f9f9cfd5-2w97n\nName:               nginx-66f9f9cfd5-2w97n\nNamespace:          default\nLabels:             "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n                    pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("66f9f9cfd5\nStatus:             Running\n\n$ kubectl get po nginx-66f9f9cfd5-2w97n -oyaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-66f9f9cfd5-2w97n\n  namespace: default\nstatus:\n  phase: Running\n")])])]),a("h3",{attrs:{id:"conditions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conditions"}},[t._v("#")]),t._v(" Conditions")]),t._v(" "),a("p",[t._v("每个 Pod 有一组 Condition，表示 Pod 在各个阶段的状态。每个 Condition 包含：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("lastProbeTime")])]),t._v(" "),a("li",[a("code",[t._v("lastTransitionTime")])]),t._v(" "),a("li",[a("code",[t._v("message")])]),t._v(" "),a("li",[a("code",[t._v("reason")])]),t._v(" "),a("li",[a("code",[t._v("status")]),t._v("：可取值为 "),a("code",[t._v("True")]),t._v("，"),a("code",[t._v("False")]),t._v(" 和 "),a("code",[t._v("Unknown")])]),t._v(" "),a("li",[a("code",[t._v("type")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("PodScheduled")]),t._v("：Pod 被调度到 Node 上")]),t._v(" "),a("li",[a("code",[t._v("Ready")]),t._v("：Pod 已经可以接受请求，并且应当加入到 Service 的负载均衡池中")]),t._v(" "),a("li",[a("code",[t._v("Initialized")]),t._v("：所有的 Init Container 都起来了")]),t._v(" "),a("li",[a("code",[t._v("Unschedulable")]),t._v("：暂时无法调度，可能是由于没有满足条件的 Node")]),t._v(" "),a("li",[a("code",[t._v("ContainersReady")]),t._v("：所有的容器都 ready")])])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl describe po nginx-66f9f9cfd5-2w97n\nName:               nginx-66f9f9cfd5-2w97n\nNamespace:          default\nLabels:             "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n                    pod-template-hash"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("66f9f9cfd5\nStatus:             Running\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\n\n$ kubectl get po nginx-66f9f9cfd5-2w97n -oyaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-66f9f9cfd5-2w97n\n  namespace: default\nstatus:\n  conditions:\n  - lastProbeTime: null\n    lastTransitionTime: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-09-03T16:50:59Z"')]),t._v("\n    status: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"True"')]),t._v("\n    type: Initialized\n  - lastProbeTime: null\n    lastTransitionTime: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-09-09T11:45:47Z"')]),t._v("\n    status: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"True"')]),t._v("\n    type: Ready\n  - lastProbeTime: null\n    lastTransitionTime: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-09-09T11:45:47Z"')]),t._v("\n    status: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"True"')]),t._v("\n    type: ContainersReady\n  - lastProbeTime: null\n    lastTransitionTime: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019-09-03T16:48:33Z"')]),t._v("\n    status: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"True"')]),t._v("\n    type: PodScheduled\n  phase: Running\n")])])]),a("h3",{attrs:{id:"restart-policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restart-policy"}},[t._v("#")]),t._v(" Restart Policy")]),t._v(" "),a("p",[a("code",[t._v("restartPolicy")]),t._v(" 对 Pod 内的所有容器都生效，可取值为：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Always")]),t._v(" (默认值)")]),t._v(" "),a("li",[a("code",[t._v("OnFailure")])]),t._v(" "),a("li",[a("code",[t._v("Never")])])]),t._v(" "),a("h2",{attrs:{id:"容器管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器管理"}},[t._v("#")]),t._v(" 容器管理")]),t._v(" "),a("h3",{attrs:{id:"imagepullpolicy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#imagepullpolicy"}},[t._v("#")]),t._v(" imagePullPolicy")]),t._v(" "),a("p",[a("code",[t._v("imagePullPolicy")]),t._v(" 指定了镜像的拉取策略，可取值为：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Always")])]),t._v(" "),a("li",[a("code",[t._v("Never")])]),t._v(" "),a("li",[a("code",[t._v("IfNotPresent")])])]),t._v(" "),a("p",[t._v("如果使用的镜像 tag 为 "),a("code",[t._v("latest")]),t._v("，则默认值为 "),a("code",[t._v("Always")]),t._v("，否则默认值为 "),a("code",[t._v("IfNotPresent")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口"}},[t._v("#")]),t._v(" 端口")]),t._v(" "),a("h3",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[t._v("#")]),t._v(" 环境变量")]),t._v(" "),a("p",[t._v("环境变量可以来自于：")]),t._v(" "),a("ul",[a("li",[t._v("直接设置的值")]),t._v(" "),a("li",[t._v("ConfigMap / Secret")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MYSQL_HOST\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("configMapRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" host\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MYSQL_PORT\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" USERNAME\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" username\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PASSWORD\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secret\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" password\n")])])]),a("h3",{attrs:{id:"资源限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源限制"}},[t._v("#")]),t._v(" 资源限制")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"200Mi"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"500m"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"100Mi"')]),t._v("\n")])])]),a("p",[t._v("其中：")]),t._v(" "),a("ul",[a("li",[t._v("cpu 可以是数字，表示核数；也可以是类似 "),a("code",[t._v("500m")]),t._v(" 的形式，"),a("code",[t._v("1000m")]),t._v(" 与 "),a("code",[t._v("1")]),t._v(" 含义相同")]),t._v(" "),a("li",[t._v("memory 可以是数字，表示 bytes；也可以带后缀作为单位，可选值为 "),a("code",[t._v("E, P, T, G, M, K, Ei, Pi, Ti, Gi, Mi, Ki")])])]),t._v(" "),a("p",[t._v("更多内容可以参考：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Assign Memory Resources to Containers and Pods"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Assign CPU Resources to Containers and Pods"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("如果需要使用 GPU 资源，参考 "),a("RouterLink",{attrs:{to:"/k8s/guides/gpu.html"}},[t._v("GPU")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"volume-挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volume-挂载"}},[t._v("#")]),t._v(" Volume 挂载")]),t._v(" "),a("p",[t._v("参考 "),a("RouterLink",{attrs:{to:"/k8s/objects/persistent-volume.html"}},[t._v("Persistent Volume")]),t._v(".")],1),t._v(" "),a("h3",{attrs:{id:"probe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#probe"}},[t._v("#")]),t._v(" Probe")]),t._v(" "),a("p",[t._v("可以为 Pod 内的容器设置探针，检测容器的状态。")]),t._v(" "),a("p",[t._v("有如下三种探针：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("livenessProbe")]),t._v(": 检测容器是否运行。如果检测失败，那么 kubelet 会 kill 掉容器")]),t._v(" "),a("li",[a("code",[t._v("readinessProbe")]),t._v(": 检测容器是否可以接收请求。如果检测失败，那么 endpoints controller 会从 Service 的 endpoints 列表中移除该 Pod 的 IP")]),t._v(" "),a("li",[a("code",[t._v("startupProbe")]),t._v(": 检测容器内的应用是否已经起来，在该探针检测成功之前，其它探针都会被禁用。对于一些启动比较慢的应用，可以使用该探针，从而避免 "),a("code",[t._v("livenessProbe")]),t._v(" 过早检测失败导致频繁重启")])]),t._v(" "),a("p",[t._v("探针可以执行以下三种操作：")]),t._v(" "),a("ul",[a("li",[t._v("执行一条命令，状态码为0则成功")]),t._v(" "),a("li",[t._v("TCP端口，可以连接则成功")]),t._v(" "),a("li",[t._v("HTTP Get 请求，返回码为 2xx 或者 3xx 则成功")])]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" goproxy\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" goproxy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" goproxy\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k8s.gcr.io/goproxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readinessProbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcpSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcpSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])])]),a("h3",{attrs:{id:"hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hooks"}},[t._v("#")]),t._v(" hooks")]),t._v(" "),a("h2",{attrs:{id:"init-container"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#init-container"}},[t._v("#")]),t._v(" Init Container")]),t._v(" "),a("h2",{attrs:{id:"qos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#qos"}},[t._v("#")]),t._v(" QoS")]),t._v(" "),a("p",[t._v("在创建一个 Pod 后，会自动为该 Pod 分配一个 QoS (Quality of Service) 等级。QoS 有如下三种：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Guaranteed")]),t._v("：Pod 中的每个容器都设置了 CPU 和 Memory 的请求和限制，且请求和限制的值相等")]),t._v(" "),a("li",[a("code",[t._v("Burstable")]),t._v("：Pod 中至少有一个容器的资源设置不满足 "),a("code",[t._v("Guaranteed")])]),t._v(" "),a("li",[a("code",[t._v("BestEffort")]),t._v("：Pod 中每一个容器都没有设置 CPU 和 Memory 的请求和限制")])]),t._v(" "),a("p",[t._v("更多信息参考 "),a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Configure Quality of Service for Pods"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"调度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调度"}},[t._v("#")]),t._v(" 调度")]),t._v(" "),a("p",[t._v("参考 "),a("RouterLink",{attrs:{to:"/k8s/guides/pod-schedule.html"}},[t._v("Pod 调度")]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"网络配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络配置"}},[t._v("#")]),t._v(" 网络配置")]),t._v(" "),a("h3",{attrs:{id:"hostnetwork"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hostnetwork"}},[t._v("#")]),t._v(" hostNetwork")]),t._v(" "),a("h3",{attrs:{id:"dnspolicy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dnspolicy"}},[t._v("#")]),t._v(" dnsPolicy")]),t._v(" "),a("h3",{attrs:{id:"dnsconfig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dnsconfig"}},[t._v("#")]),t._v(" dnsConfig")]),t._v(" "),a("h3",{attrs:{id:"hostaliases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hostaliases"}},[t._v("#")]),t._v(" hostAliases")]),t._v(" "),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Adding entries to Pod /etc/hosts with HostAliases"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pod Overview"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pods"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pod Lifecycle"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Configure Liveness, Readiness and Startup Probes"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Init Containers"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);
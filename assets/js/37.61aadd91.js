(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{415:function(t,a,s){"use strict";s.r(a);var n=s(42),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#创建-deployment"}},[t._v("创建 Deployment")])]),s("li",[s("a",{attrs:{href:"#扩容"}},[t._v("扩容")]),s("ul",[s("li",[s("a",{attrs:{href:"#手动扩容"}},[t._v("手动扩容")])]),s("li",[s("a",{attrs:{href:"#自动扩容"}},[t._v("自动扩容")])])])]),s("li",[s("a",{attrs:{href:"#滚动升级"}},[t._v("滚动升级")]),s("ul",[s("li",[s("a",{attrs:{href:"#升级"}},[t._v("升级")])]),s("li",[s("a",{attrs:{href:"#升级历史"}},[t._v("升级历史")])]),s("li",[s("a",{attrs:{href:"#回滚"}},[t._v("回滚")])]),s("li",[s("a",{attrs:{href:"#升级策略"}},[t._v("升级策略")])])])]),s("li",[s("a",{attrs:{href:"#参考"}},[t._v("参考")])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"创建-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建-deployment"}},[t._v("#")]),t._v(" 创建 Deployment")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.16")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("p",[t._v("Deployment 会自动创建 ReplicaSet：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl get deploy\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("           4s\n\n$ kubectl get rs\nNAME               DESIRED   CURRENT   READY     AGE\nnginx-65fc954674   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         12s\n\n$ kubectl get po\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-65fc954674-2tc4v   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          15s\nnginx-65fc954674-fmqpf   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          15s\nnginx-65fc954674-ssz7x   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          15s\n")])])]),s("h2",{attrs:{id:"扩容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#扩容"}},[t._v("#")]),t._v(" 扩容")]),t._v(" "),s("h3",{attrs:{id:"手动扩容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动扩容"}},[t._v("#")]),t._v(" 手动扩容")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl scale --replicas"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" deploy/nginx\n")])])]),s("h3",{attrs:{id:"自动扩容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动扩容"}},[t._v("#")]),t._v(" 自动扩容")]),t._v(" "),s("p",[t._v("参考 "),s("RouterLink",{attrs:{to:"/k8s/objects/horizontal-pod-autoscaler.html"}},[t._v("HorizontalPodAutoscaler")]),t._v("。")],1),t._v(" "),s("h2",{attrs:{id:"滚动升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#滚动升级"}},[t._v("#")]),t._v(" 滚动升级")]),t._v(" "),s("h3",{attrs:{id:"升级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[t._v("#")]),t._v(" 升级")]),t._v(" "),s("p",[t._v("只有当 Deployment 中 Pod 的模板发生改变时，才会触发升级，即 "),s("code",[t._v("spec.template")]),t._v(" 发生变化。例如修改镜像为 "),s("code",[t._v("nginx:1.17.2")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("1.17.2\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),s("p",[t._v("然后进行查看：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl get deploy\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nnginx     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("           48s\n\n$ demo kubectl get rs\nNAME               DESIRED   CURRENT   READY     AGE\nnginx-56b7d6bcf7   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("         10s\nnginx-65fc954674   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("         51s\n\n$ demo kubectl get po\nNAME                     READY     STATUS    RESTARTS   AGE\nnginx-56b7d6bcf7-2jhsm   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          11s\nnginx-56b7d6bcf7-dxkf5   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          15s\nnginx-56b7d6bcf7-q6jss   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/1       Running   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("          13s\n")])])]),s("p",[t._v("可以看到，更新之后，会生成一个新的 ReplicaSet。")]),t._v(" "),s("p",[t._v("查看升级状态：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl rollout status deploy/nginx\ndeployment "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(" successfully rolled out\n")])])]),s("p",[t._v("查看 Deployment 的滚动升级详情：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl describe deploy nginx\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nEvents:\n  Type    Reason             Age   From                   Message\n  ----    ------             ----  ----                   -------\n  Normal  ScalingReplicaSet  3m    deployment-controller  Scaled up replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-65fc954674 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled up replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-56b7d6bcf7 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled down replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-65fc954674 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled up replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-56b7d6bcf7 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled down replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-65fc954674 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled up replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-56b7d6bcf7 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  Normal  ScalingReplicaSet  2m    deployment-controller  Scaled down replica "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" nginx-65fc954674 to "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("h3",{attrs:{id:"升级历史"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级历史"}},[t._v("#")]),t._v(" 升级历史")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ kubectl rollout "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" deploy/nginx\ndeployments "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v("\nREVISION  CHANGE-CAUSE\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n$ kubectl rollout "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" deploy/nginx --revision"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\ndeployments "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(" with revision "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#2")]),t._v("\nPod Template:\n  Labels:\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n\tpod-template-hash"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1263826793")]),t._v("\n  Containers:\n   nginx:\n    Image:\tnginx:1.17.2\n    Port:\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/TCP\n    Host Port:\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("/TCP\n    Environment:\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    Mounts:\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  Volumes:\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[s("code",[t._v(".spec.revisionHistoryLimit")]),t._v(" 可以设置保留多少次升级历史，默认为 10。如果设置为 0，则不保留任何升级历史，因此也就无法执行回滚操作。")]),t._v(" "),s("h3",{attrs:{id:"回滚"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#回滚"}},[t._v("#")]),t._v(" 回滚")]),t._v(" "),s("p",[t._v("修改 YAML 文件为上个版本，重新 apply，可以做回滚操作；或者")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 回滚到上一版本")]),t._v("\n$ kubectl rollout undo deploy/nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 回滚到指定版本")]),t._v("\n$ kubectl rollout undo deploy/nginx --to-revision"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("h3",{attrs:{id:"升级策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#升级策略"}},[t._v("#")]),t._v(" 升级策略")]),t._v(" "),s("p",[s("code",[t._v(".spec.strategy")]),t._v(" 可以设置升级策略，其中 "),s("code",[t._v(".spec.strategy.type")]),t._v(" 可以取值为：")]),t._v(" "),s("ul",[s("li",[t._v("Recreate：会直接 kill 掉已有 Pod，然后重新创建")]),t._v(" "),s("li",[t._v("RollingUpdate：滚动升级，默认策略。如果为该策略，还可以设置 "),s("code",[t._v("maxUnavailable")]),t._v(" 和 "),s("code",[t._v("maxSurge")]),t._v(" 来控制升级的过程")])]),t._v(" "),s("p",[t._v("更多详情参考 "),s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy",target:"_blank",rel:"noopener noreferrer"}},[t._v("Strategy"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deployments"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);
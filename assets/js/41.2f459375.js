(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{380:function(s,t,n){"use strict";n.r(t);var a=n(42),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"ingress"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ingress"}},[s._v("#")]),s._v(" Ingress")]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#ingress-和-ingress-controller"}},[s._v("Ingress 和 Ingress Controller")])]),n("li",[n("a",{attrs:{href:"#安装-ingress-controller"}},[s._v("安装 Ingress Controller")])]),n("li",[n("a",{attrs:{href:"#创建-ingress"}},[s._v("创建 Ingress")]),n("ul",[n("li",[n("a",{attrs:{href:"#ip-访问"}},[s._v("IP 访问")])]),n("li",[n("a",{attrs:{href:"#域名分流"}},[s._v("域名分流")])])])]),n("li",[n("a",{attrs:{href:"#参考"}},[s._v("参考")])])])]),n("p"),s._v(" "),n("h2",{attrs:{id:"ingress-和-ingress-controller"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ingress-和-ingress-controller"}},[s._v("#")]),s._v(" Ingress 和 Ingress Controller")]),s._v(" "),n("p",[s._v("Ingress 可以将集群内的服务对外暴露，并且提供了负载均衡，HTTPS，以及基于域名的分流支持。Ingress 本身是一种配置，配置了如何对外提供服务。")]),s._v(" "),n("p",[s._v("如果需要 Ingress 真正生效，需要依赖于 Ingress Controller。可以简单类比为，Ingress Controller 就像是 Nginx，而 Ingress 则是 Nginx 的配置。")]),s._v(" "),n("p",[s._v("常见的 Ingress Controller 有多种，例如 "),n("a",{attrs:{href:"https://kubernetes.github.io/ingress-nginx/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ingress-nginx"),n("OutboundLink")],1),s._v("，"),n("a",{attrs:{href:"https://www.getambassador.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ambassador"),n("OutboundLink")],1),s._v(" 等，使用不同的 Ingress Controller 的时候，Ingress 的配置也会有所差别。")]),s._v(" "),n("p",[s._v("这里以 ingress-nginx 为例。")]),s._v(" "),n("h2",{attrs:{id:"安装-ingress-controller"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-ingress-controller"}},[s._v("#")]),s._v(" 安装 Ingress Controller")]),s._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ helm "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --name nginx --namespace ingress-nginx stable/nginx-ingress\n\n$ kubectl get all -n ingress-nginx\nNAME                                                      READY   STATUS    RESTARTS   AGE\npod/nginx-nginx-ingress-controller-7d9449d76c-v4cf9       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\npod/nginx-nginx-ingress-default-backend-7f79f9545-9px9f   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\n\nNAME                                          TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      AGE\nservice/nginx-nginx-ingress-controller        LoadBalancer   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.97")]),s._v(".45.251     localhost     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":30432/TCP,443:32760/TCP   30s\nservice/nginx-nginx-ingress-default-backend   ClusterIP      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.108")]),s._v(".182.134   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP                       30s\n\nNAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/nginx-nginx-ingress-controller        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           30s\ndeployment.apps/nginx-nginx-ingress-default-backend   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           30s\n\nNAME                                                            DESIRED   CURRENT   READY   AGE\nreplicaset.apps/nginx-nginx-ingress-controller-7d9449d76c       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       30s\nreplicaset.apps/nginx-nginx-ingress-default-backend-7f79f9545   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       30s\n")])])]),n("h2",{attrs:{id:"创建-ingress"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-ingress"}},[s._v("#")]),s._v(" 创建 Ingress")]),s._v(" "),n("h3",{attrs:{id:"ip-访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ip-访问"}},[s._v("#")]),s._v(" IP 访问")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/ingress.class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ kubectl get ingress\nNAME    HOSTS   ADDRESS   PORTS   AGE\nnginx   *                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      3s\n")])])]),n("h3",{attrs:{id:"域名分流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#域名分流"}},[s._v("#")]),s._v(" 域名分流")]),s._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.k8s.io/v1beta1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Ingress\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("annotations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/ingress.class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("example.com\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("backend")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servicePort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get ingress\nNAME    HOSTS               ADDRESS   PORTS   AGE\nnginx   nginx-example.com             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("      10s\n")])])]),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress Controllers"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);